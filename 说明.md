# 平衡小车零基础使用说明

这份说明面向**完全零基础**的同学，带你从安装工具到联网控制平衡小车。请按顺序完成，第一次操作建议一步不落。

## 0. 准备硬件与网络
- 一台带 Type‑C 数据线的 ESP32 平衡车主控板（供电稳定，最好接电脑 USB 口或可靠电源适配器）。
- 一条可传输数据的 USB 线（仅充电线无法烧录）。
- 一张 2.4GHz Wi‑Fi 热点（路由器或手机热点），知道它的名称和密码。
- 一台电脑（Windows/macOS/Linux 均可）和浏览器（Chrome/Edge/Firefox 等）。

## 1. 安装 VS Code 与 PlatformIO
1. 前往 https://code.visualstudio.com/ 下载并安装 VS Code。安装完成后启动 VS Code。
2. 在左侧工具栏点击“扩展”图标（方块拼图），在搜索框输入 `PlatformIO IDE`，点击“安装”。
3. 安装结束后 VS Code 会提示重载或自动重启，按提示操作。首次启动 PlatformIO 会自动下载编译/烧录工具，等待它完成。

## 2. 下载并打开项目
- 方法 A：如果会用 Git，在终端执行 `git clone <项目地址>`，然后在 VS Code 选择“文件”→“打开文件夹”，选中仓库目录。
- 方法 B：在项目页面点 “Code”→“Download ZIP”，解压后用 VS Code 打开解压出的文件夹。

## 3. 配置 Wi‑Fi 信息
1. 在 VS Code 左侧资源管理器找到 `include/my_config.h`。
2. 找到下列两行，将双引号内改成你自己的热点名称和密码（仅支持 2.4GHz）：
   ```cpp
   #define SSID "你的WiFi名称"
   #define PASSWORD "你的WiFi密码"
   ```
3. 保存文件（Ctrl/Cmd+S）。

## 4. 连接开发板
1. 用数据线把平衡车主控板连接到电脑。
2. 如果系统提示需要驱动，按提示安装（常见为 CP210x/CH34x 驱动）。安装后重新插拔一次。
3. 记住电脑识别到的串口：Windows 通常是 `COM数字`，macOS/Linux 通常是 `/dev/cu.usb*` 或 `/dev/ttyUSB*`。

## 5. 编译与烧录固件
1. 打开 VS Code 左侧的外星人图标（PlatformIO）。
2. 先点击“Project Tasks”→`env:4d_systems_esp32s3_gen4_r8n16`→“General”→“Build”运行一次，确认代码能正常编译。
3. 编译通过后，点击同一位置的“Upload”开始烧录。若弹窗让你选端口，选择上一步看到的串口。
4. 烧录成功后，状态栏会显示 “Success”。若失败，可尝试：
   - 更换数据线或 USB 口。
   - 板子有 BOOT/EN 按键时，按住 BOOT 点击 EN/RESET，再松开 BOOT 后重试 Upload。

## 6. 打开串口查看 IP
1. 在 PlatformIO 的同一任务列表中点击 “Monitor” 打开串口监视器。
2. 左下角确认波特率为 **115200**（主程序在 `Serial.begin(115200);`）。
3. 串口窗口会先打印 `Connecting to WiFi...`，成功后出现：
   ```
   Connected to WiFi
   IP Address: 192.168.x.x
   ```
   记下这行 IP 地址。

## 7. 浏览器控制小车
1. 确保电脑与小车连接的是**同一个热点**（与步骤 3 设置的 Wi‑Fi 一致）。
2. 在浏览器地址栏输入刚才记下的 `http://<IP地址>`，打开网页控制界面。
3. 页面加载后点击“运行/开始”按钮，小车会进入自平衡并可移动。

## 8. 车组模式（编队）
1. 让每辆小车都先进入网页端并切换到“车组模式”/“编队模式”。
2. 在其中一辆小车的网页端输入其它小车的 IP 地址，保存或添加后即可组成车队。
3. 确保所有小车都连在同一热点，保持信号良好。

## 9. 常见问题排查
- 无法连接 Wi‑Fi：确认热点是 2.4GHz；SSID/密码无中文空格/输错大小写；热点允许新设备加入。
- 烧录失败：换数据线/USB 口；检查是否选对串口；必要时手动进下载模式（按 BOOT+RESET）。
- 网页打不开：电脑和小车必须在同一网络；确认串口打印的 IP 是否变化；路由器有时会更换 IP，重新上电查看最新 IP。
- 小车不动或异常：先停用“运行”，重新上电；保持场地平整，避免在高低不平处调试。

## 10. 调参教程
### 网页端调参功能
- 曲线看板：顶部 3 张图分别是「直立环」「速度环」「位置环」，每张都有 `now`（当前测量）、`tor`（控制输出/扭矩指令）、`err`（误差）三条曲线，用来观察响应、输出是否饱和以及误差是否收敛。
- 控制参数：下方四组 PID 滑块+数字框，依次对应「直立环、速度环、位置环、偏航环」，每组都有 P/I/D 三个通道。拖动滑块可粗调，右侧数字框可精确输入，实时回显当前值。
- 按钮作用：点击“发送”将当前 12 个 PID 值下发到主控并立即生效；点击“更新”从主控读回现有 PID 并填入页面（上电后建议先点一次以同步固件内的默认值）。
- 安全建议：调参时将小车放在平整地面或用手轻扶，随时准备关闭“运行”开关或断电避免摔车。

### 调参思路（由内到外）
1. **直立环（姿态）**：先只关注能否稳住角度。逐步增大 P，直到出现轻微抖动或尖锐噪音时回退一点；再加少量 D 抑制晃动；最后视情况加一点 I 消除慢慢倾斜的偏差。观察 `now` 是否紧跟、`err` 是否快速回零。
2. **速度环（车速）**：在直立稳定后调速度环。保持位置环/偏航环较小，缓慢增加 P 让小车能跟随前后推拉而不过冲；如出现来回摆动，减小 P 或增加少量 D。I 用于消除长时间匀速行驶时的速度偏差，量不要大。
3. **位置环（位移保持）**：需要让小车回到指定位置时才开启。先给很小的 P，确认不会剧烈往返；若刹车过冲，可加一点 D。位置环 I 容易积累，通常保持很小或先不启用。
4. **偏航环（朝向）**：最后调转向，数值通常比其它环更小。P 够用即可让小车缓慢归正朝向；如左右抖头，加少量 D。偏航 I 仅在长期偏航时再考虑。
5. **操作节奏**：一次只改一个参数，小步调整（0.001~0.01），每次点击“发送”后观察曲线变化与车体行为；记录改动，失稳就退回上一次稳定值或点“更新”同步固件值重新开始。
